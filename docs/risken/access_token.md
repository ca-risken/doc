# アクセストークン

プログラムからRISKEN上のデータにアクセスするにはアクセストークンが必要です。

ここでは新しくアクセストークンを発行しAPIアクセスするまでのフローを説明します。

---

## アクセストークンを発行する

1. 画面上メニューの`P`ボタンより対象のプロジェクトを選択します
2. 左メニューより`IAM > AccessToken`をクリックします
    - ![アクセストークンリスト](/img/risken/access_token_list.png){style="width:400px"}
3. 画面右側にある`NEW`ボタンをクリックします
4. 以下の項目を入力します
    - **Name** : アクセストークン名
    - **Description** : 説明（トークンの利用目的等）
    - **ExpiredAt** : トークンの有効期限
    - **Role** : アクセストークンに付与するロールを選択します（ロールの詳細は [ロール設定](/risken/user/#_4) を参照してください ）
5. `REGIST`ボタンをクリックします
    - ![アクセストークンダイアログ](/img/risken/access_token_dialog.png){style="width:400px"}
6. アクセストークンが表示されたら必ずメモして大切に保管してください
    - ![新規トークン](/img/risken/new_token.png){style="width:300px"}

???+ note
    アクセストークンは最初に一度だけ表示され、以降は参照できなくなります。

---

## アクセストークンを用いてAPIアクセスする

1. 有効なアクセストークンを準備します
    - アクセストークンに適切なロールが付与されていることを確認してください
    - アクセストークンの有効期限が切れていないか確認してください
    - アクセストークンに紐づくプロジェクトに一人以上のメンバー（トークン管理者）がいることを確認してください

2. curlにて
```bash
$ curl -XGET \
    --header 'Authorization: Bearer {your-token-here}' \
    'https://{your-site}/api/v1/iam/list-user/?activated=true'
```

???+ warning
    APIエンドポイントの詳細（`{your-site}`）はシステム管理者に問い合わせてください。
    
    また、上記手順でアクセスできない場合、APIのエンドポイントにIP制限などのACL設定や、トークン以外の認証方式が設定されている可能性があります。
    詳細はシステム管理者にご確認ください。

---

## アクセストークンの有効期限切れを検知する

アクセストークンの有効期限切れが発生した場合には、対象のトークンがFindingとして `0.8` のスコアで登録されます。

なので、通知を受け取るには、[アラート設定](/risken/alert/#_3) にて適切な条件を設定し、通知先もあわせて設定してください。

以下は、アクセストークンの有効期限切れを検知するためのアラート条件の例になります

- **スコア** : 0.8
- **タグ** : `access-token`

???+ note "デフォルトのアラート条件"
    プロジェクトを作成するとデフォルトでスコア 0.8以上のアラート条件が登録されるため、アクセストークンの有効期限切れのアラートもデフォルトの条件に含まれます
    
    ＊ただし、デフォルト条件を利用する場合でも通知先の設定は別途必要になります。

---

## APIリファレンス

APIの詳細は [APIリファレンス](/reference/api/) を参照してください
